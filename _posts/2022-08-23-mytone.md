---
layout : single
title:  "MyTone"
last_modified_at : 2022-09-01
categories: mytone
toc: true
toc_sticky: true
---
# í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì›¹ì‚¬ì´íŠ¸

## ì œì‘ë™ê¸°
ìµœê·¼ í¼ìŠ¤ë„ ì»¬ëŸ¬ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬ë„ì™€ í¼ìŠ¤ë„ ì»¬ëŸ¬ ì§„ë‹¨ ì„œë¹„ìŠ¤ ì‹œì¥ì˜ í­ë°œì ì¸ ì„±ì¥ ì—¬ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì£¼ì œë¥¼ ì„ ì •í•˜ì˜€ê³ , í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. 

í”„ë¡ íŠ¸ì—”ë“œ(React)ë¡œ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í–ˆìœ¼ë©° ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, íšŒì›ê°€ì…, ê²Œì‹œíŒ êµ¬í˜„ì„ ë§¡ì•˜ìŠµë‹ˆë‹¤.  


## êµ¬í˜„ê¸°ëŠ¥
- ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, íšŒì›ê°€ì… (jwtë¥¼ ì‚¬ìš©í•œ íšŒì›ì¸ì¦)
- ê²Œì‹œíŒ CRUD, ëŒ“ê¸€ê³¼ ëŒ€ëŒ“ê¸€ CRUD

## 1. ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, íšŒì›ê°€ì… (jwtë¥¼ ì‚¬ìš©í•œ íšŒì›ì¸ì¦)

### 1-1. íšŒì›ê°€ì…

```js
function SignUp() {
    ...
    return (
        ...
            <Form action="/" className="form-top"
                onSubmit={function (e) {
                    e.preventDefault();
                    axios.post('/user/register/', {
                        username: e.target.username.value,
                        password1: e.target.password1.value,
                        password2: e.target.password2.value,
                        nickname: e.target.nickname.value,
                        gender: e.target.gender.value == 'femail' ? 'W' : 'M'
                    }).then((res) => {
                        if (res.status == 200) { // ê°€ì… ì„±ê³µ
                            alert(res.data.message);
                            navigate('/signin')
                        } else { // ê°€ì… ì‹¤íŒ¨
                            alert('ê°€ì… ì‹¤íŒ¨!!');
                        }
                    }).catch((err) => {
                        console.log(err);
                    })
                }}>
                ...
            </Form>
    );

}
export default SignUp
```
`<form>`íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì˜€ê³ , axiosë¥¼ ì‚¬ìš©í•´ì„œ ì„œë²„ë¡œ postí•˜ì˜€ë‹¤.  
ì´ë•Œ `e.preventDefault()`ëŠ” form ì•ˆì— submitì—­í• ì„ í•˜ëŠ” ë²„íŠ¼ì„ ëˆŒë €ì–´ë„ í™”ë©´ì„ ìƒˆë¡œê³ ì¹¨ í•˜ì§€ì•Šê¸° ìœ„í•´ì„œ ì‚¬ìš©í–ˆë‹¤.(submitì€ ì‘ë™ë¨)

----

### 1-2. ë¡œê·¸ì¸

```js
<form onSubmit={(e) => {
    e.preventDefault();
    axios.post('/user/login/', {
        username: e.target.username.value,
        password: e.target.password.value,
    })
    .then((res) => {
          if (res.status == 200) {
              alert(res.data.message)
              localStorage.setItem('UserID', res.data.token.user);
              setRefreshToken(res.data.token.refresh_token); //ì¿ í‚¤ì— refreshTokenì €ì¥
              dispatch(setAuthToken(res.data.token.access_token));//reduxì— accessTokenì €ì¥
              navigate('/');
          }
        })
    .catch((err) => {
          if (err.response.status == 400) {
              alert('ì•„ì´ë”” í˜¹í‹€ë ¸ìŠµë‹ˆë‹¤')
          }
          setValue("password", "");
        })
  }>
```

ì„œë²„ë¡œ postìš”ì²­ì´ ì„±ê³µí•˜ë©´ responseë¡œ accessTokenê³¼ refreshTokenì„ ë°›ëŠ”ë‹¤.  
> accessToken : redux storeì— ì €ì¥  
refreshToken : ì¿ í‚¤ì— ì €ì¥

accessTokenì˜ ê²½ìš° íƒˆì·¨ì˜ ìœ„í—˜ì´ ìˆê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì € ì €ì¥ì†Œ(localStorage, cookie)ê°€ ì•„ë‹Œ storeì— ì €ì¥í–ˆë‹¤.    

ì´ë•Œ storeì— ì €ì¥í•˜ë©´ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆê³ ë¡œì¹¨ í•  ë•Œ reduxê°’ì´ ì´ˆê¸°ê°’ìœ¼ë¡œ ëŒì•„ê°€ë©´ì„œ ë¡œê·¸ì•„ì›ƒì´ ë˜ëŠ”ë° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨ ë  ë•Œë§ˆë‹¤ refreshTokenì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ì„ ì—°ì¥ì‹œì¼œ ì¤¬ë‹¤.   

ì´ë¥¼ ìœ„í•´ì„œ ìš°ì„  App.jsì˜ `<Route>`ë“¤ <span style="color:green; font-weight:bold">ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì»´í¬ë„ŒíŠ¸</span>ë¥¼ ë§Œë“¤ì—ˆë‹¤.     
**(nested routeë¥¼ ì‚¬ìš©í•´ì„œ ìƒìœ„ routeì—ì„œ tokenì„ ê²€ì‚¬ í˜¹ì€ ì—°ì¥ì„ í•œ í›„ `<Outlet>`ì„ í†µí•´ í•˜ìœ„ routeë“¤ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ)**  

<span style="color:green; font-weight:bold">ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì»´í¬ë„ŒíŠ¸</span>ëŠ” ë‘ ê°€ì§€ë¡œ ë‚˜ëˆ´ë‹¤.  
- `<PublicRoute>`(accessTokenì—†ì´ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ routeë“¤ì„ ê°ìŒˆ)
- `<PrivateRoute>`(accessTokenì´ ìˆì–´ì•¼ë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ routeë“¤ ê°ìŒˆ)
<center>ğŸ‘‡</center>
```js
<Routes>
          <Route element={<PublicRoute></PublicRoute>}> 
              ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” Route
          </Route>
          
          <Route element={<PrivateRoute></PrivateRoute>}> 
              ë¡œê·¸ì¸ì„ í•´ì•¼ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” Route
          </Route>

          <Route path='*' element={<div>ì˜ëª»ëœ ê²½ë¡œì…ë‹ˆë‹¤:(</div>}></Route>
</Routes>
```
`<PublicRoute>`, `<PrivateRoute>`ì—ì„œëŠ” í† í° ê²€ì‚¬í•¨ìˆ˜ `CheckToken`ì„ ìˆ˜í–‰í•˜ëŠ”ë° ì´ í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ìƒˆë¡œê³ ì¹¨ ë§ˆë‹¤ refreshTokenì„ í†µí•´ ë¡œê·¸ì¸ì„ ìœ ì§€ì‹œì¼œ ì¤€ë‹¤.


- PrivateRoute.js  

```js
//
import { CheckToken } from '../auth/CheckToken';
import { Outlet} from 'react-router';


export default function PrivateRoute() {
   
    const { isAuth } = CheckToken(location.key); //CheckTokení•¨ìˆ˜ ìˆ˜í–‰

    if (isAuth === 'Failed') {
        ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    } else if (isAuth==='Loading') {
        ë¡œë”©ì¤‘ ì»´í¬ë„ŒíŠ¸ ë³´ì—¬ì¤Œ
    }

    return <Outlet /> // ì„±ê³µí•˜ë©´ í•˜ìœ„ Routeë¥¼ ë³´ì—¬ì¤Œ
}

```
<center>ğŸ‘‡ (PrivateRouteì˜ CheckTokení•¨ìˆ˜)</center>

- CheckToken.js  

```js
import { useEffect, useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { getRefreshToken, removeRefreshToken } from '../cookie/Cookie';
import { requestToken } from '../api/url';
import { deleteAuthToken, setAuthToken } from '../store';

export function CheckToken(key){
    const [isAuth,setIsAuth] = useState('Loading');
    const {authenticated,expireTime} = useSelector(state=>state.token);
    const refreshToken = getRefreshToken();
    const dispatch = useDispatch();

    useEffect(()=>{
        const checkAuthToken = async ()=>{
            if(refreshToken==undefined){
                dispatch(deleteAuthToken());
                setIsAuth('Failed');
            }else{
                if (authenticated && new Date().getTime() < expireTime){
                    setIsAuth('Success');
                }else{
                    const response = await requestToken(refreshToken); // accessToken ì¬ë°œê¸‰ ìˆ˜í–‰ í•¨ìˆ˜

                    if(response.status){
                        const token = response.access_token;
                        dispatch(setAuthToken(token));
                        setIsAuth('Success')
                    }else{
                        dispatch(deleteAuthToken());
                        removeRefreshToken();
                        setIsAuth('Failed');
                    }
                }
            }
        }

        checkAuthToken();

    },[refreshToken,dispatch,key])

    return{
        isAuth
    };
}
```
`useEffect`ë¥¼ ì‚¬ìš©í•´ì„œ depsì•ˆì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì¿ í‚¤ì— ì €ì¥ëœ refreshTokenì˜ ìœ ë¬´ì™€ reduxì— ì €ì¥ëœ accessTokenì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•œë‹¤.  

refreshTokenì´ ìˆê³  accessTokenì´ ë§Œë£Œë˜ì—ˆë‹¤ë©´ `requestToken`í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ accessTokenì„ ì¬ë°œê¸‰ ë°›ëŠ”ë‹¤.  

ìµœì¢…ê²°ê³¼ë¥¼ `isAuth` stateì— ì €ì¥í•˜ê³  returní•œë‹¤.  

- useEffectì˜ deps
    - `refreshToken` : cookieì— ì €ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ìƒˆë¡œê³ ì¹¨ì„ í•˜ë”ë¼ë„ ì—¬ì „íˆ ê°™ì€ ê°’ì„ ìœ ì§€í•œë‹¤. ë”°ë¼ì„œ í•´ë‹¹ í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ìœ ì €ê°€ ì¸ì¦ëœ(ë¡œê·¸ì¸ ëœ) ìœ ì €ì¸ì§€ë¥¼ íŒë³„í•˜ê¸° ìœ„í•œ ê°’ìœ¼ë¡œ `ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ`ì„ ìˆ˜í–‰í–ˆì„ ë•Œë§Œ useEffectê°€ ì‹¤í–‰ëœë‹¤.
    - `dispatch` :  **accessToken**ì„ reduxì— ì €ì¥í•˜ê¸° ìœ„í•œ usdDispatch hookì´ë‹¤. ë”°ë¼ì„œ dispatchëŠ” useDispatch hookì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„ ì–¸í•œ ë³€ìˆ˜ë¡œ ê³„ì† ê°™ì€ ê°’ì„ ìœ ì§€í•˜ê²Œ ë˜ê³ , ë”°ë¼ì„œ `ì•±ì´ ìµœì´ˆë¡œ ëœë”ë§(ìƒˆë¡œê³ ì¹¨ ì œì™¸)` ë˜ì—ˆì„ ë•Œì—ë§Œ useEffectê°€ ì‹¤í–‰ëœë‹¤. ì´ˆê¸°ì— checkTokení•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì„ ì–¸í•˜ì˜€ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.
    - `key` :  useLocation hookìœ¼ë¡œ ë¶€í„° return ë°›ì€ location ê°ì²´ì˜ ì¼ë¶€ì´ë‹¤. location ê°ì²´ì˜ ê³ ìœ  ì‹ë³„ìë¡œ í´ë¦­ìœ¼ë¡œ ì¸í•œ ë§í¬ ì´ë™ ë˜ëŠ” `ìƒˆë¡œê³ ì¹¨`ì‹œ ê°’ì´ ë³€í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ë§í¬ì´ë™ (routerì´ë™) ë¿ ì•„ë‹ˆë¼ **ì›¹ ë¸Œë¼ìš°ì €ì˜ ìƒˆê³ ë¡œì¹¨ ì‹œì—ë„ checkTokení•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì„ ì–¸í•˜ì˜€ë‹¤.**


ğŸ”…<span style="color:green; font-weight:bold">checkToken.jsì˜ useEffect deps ì¤‘ keyê°€ ì›¹ ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ë¡œê·¸ì¸ì´ ìœ ì§€ë  ìˆ˜ ìˆê²Œí•˜ëŠ” ì—­í• ì„ í•œë‹¤.</span>ğŸ”…  

<center>ğŸ‘‡ (CheckTokení•¨ìˆ˜ ì•ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” requestTokení•¨ìˆ˜)</center>

- requestTokení•¨ìˆ˜  

```js

export const requestToken = async (refreshToken)=>{
    
    const data = await axios.post('/refeshTokenìœ¼ë¡œ accessTokenë°œê¸‰í•´ì£¼ëŠ” api',{ refreshToken : refreshToken }).catch(()=>{
        return statusError;
    })

    if (parseInt(Number(data.status))===200){
        console.log(data)
        const status = true;
        const code = data.status;
        const access_token = data.data.token.access_token;

        return {
            status,
            code,
            access_token
            
        };
    }else{
        return statusError;
    }
};
```


---


## 2. ê²Œì‹œíŒ

ì¹´í…Œê³ ë¦¬ ë³„ë¡œ ê²Œì‹œíŒ ëª©ë¡ì„ ë³´ì—¬ì£¼ê³  í´ë¦­ì‹œ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆë‹¤.  
ì´ë•Œ ì¢Œì¸¡ì— ì¹´í…Œê³ ë¦¬ ë°”ëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  ëª©ë¡í˜ì´ì§€ì™€ ìƒì„¸í˜ì´ì§€ë§Œ ë°”ë€Œë„ë¡ nested routeë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í–ˆë‹¤.  
>ëª©ë¡í˜ì´ì§€
![image](https://user-images.githubusercontent.com/80660585/186662539-c0ef0937-9b5d-468f-b651-6f67456ae7e8.png)  

>ìƒì„¸í˜ì´ì§€
![image](https://user-images.githubusercontent.com/80660585/186662653-a689dc08-2210-4b31-ae72-49b732ee043a.png)


```js
<Route path="/board" element={<ArticleCategory category={category} setCategory={setCategory} setSearchToggle={setSearchToggle} />}> {/*nested route ì‚¬ìš©*/}
    <Route path="list" element={<Article category={category} setCategory={setCategory} searchToggle={searchToggle} setSearchToggle={setSearchToggle}  />}></Route>  {/*/board/listë¡œ ì ‘ì†í•˜ë©´ ì¹´í…Œê³ ë¦¬ì™€ ê²Œì‹œíŒ ëª©ë¡ì„ ë³´ì—¬ì¤Œ*/}
    <Route path="detail/:id" element={<ArticleDetail setCategory={setCategory} recommentList={recommentList} setSearchToggle={setSearchToggle}/>}></Route> {/*/board/detail/:idë¡œ ì ‘ì†í•˜ë©´ ì¹´í…Œê³ ë¦¬ì™€ ìƒì„¸ ê²Œì‹œíŒì„ ë³´ì—¬ì¤Œ*/}
</Route>
```

ì´ë•Œ ì¹´í…Œê³ ë¦¬ ë°”ë¥¼ í¼ì³¤ë‹¤ê°€ ì ‘ì—ˆë‹¤ê°€ í•  ìˆ˜ ìˆëŠ” boot-strapì„ ì‚¬ìš©í–ˆëŠ”ë° ëª©ë¡ì—ì„œ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜, ìƒì„¸í˜ì´ì§€ì—ì„œ ëª©ë¡ìœ¼ë¡œ ì´ë™ í•  ë•Œë§ˆë‹¤ ê³„ì† ì¬ëœë”ë§ì´ ì¼ì–´ë‚¬ë‹¤. (ì´ë™í•  ë•Œ ë§ˆë‹¤ ì ‘í˜”ë‹¤ í´ì§)  

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ localStorageì— ì¹´í…Œê³ ë¦¬ ë°”ì˜ ìƒíƒœë¥¼ ì €ì¥í–ˆë‹¤.   

>ë‹«ì•˜ì„ë•Œ
![image](https://user-images.githubusercontent.com/80660585/186664948-2093f053-0a95-4349-9493-244f178f1da8.png)

>ì—´ì—ˆì„ë•Œ
![image](https://user-images.githubusercontent.com/80660585/186665046-95d8922b-9e74-4afe-af53-18bdb59e19c6.png)

## 3. ëŒ“ê¸€ ìˆ˜ì • 

ëŒ“ê¸€ ì˜† ìˆ˜ì •ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëŒ“ê¸€ì°½ì´ ì…ë ¥ì°½ìœ¼ë¡œ ë°”ë€Œê³  ëŒ“ê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.  

ì„¸ê°œì˜ stateë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.  
1. ìˆ˜ì •ë²„íŠ¼ì„ ëˆŒë €ëŠ”ì§€ ë‚˜íƒ€ë‚´ëŠ” state  
2. ìˆ˜ì •ë²„íŠ¼ì„ ëˆ„ë¥¸ ëŒ“ê¸€ì˜ idë¥¼ ê¸°ì–µí•˜ëŠ” state  
3. ëŒ“ê¸€ì˜ ë‚´ìš©ì„ ê¸°ì–µí•˜ëŠ” state  
<center>ğŸ‘‡</center> 
```js
let [editClicked, setEditClicked] = useState(false);
let [editCommentId, setEditCommentId] = useState();
let [edittingComment, setEdittingComment] = useState('');
```

ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `editClicked`ê°€ trueë¡œ ë°”ë€Œê³ , editCommentIdëŠ” ìˆ˜ì •ë²„íŠ¼ì„ ëˆ„ë¥¸ ëŒ“ê¸€ì˜ idë¡œ ë°”ë€ë‹¤. edittingCommentëŠ” ìˆ˜ì •ì¤‘ì¸ ë‚´ìš©ìœ¼ë¡œ ë°”ë€ë‹¤.  
editClickedì™€ editCommentIdì„ ì‚¬ìš©í•˜ì—¬ `ìˆ˜ì •`ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `ìˆ˜ì •ì™„ë£Œ`ë²„íŠ¼ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.  
<center>ğŸ‘‡</center>   

```js
{
    editClicked == true && editCommentId == a.id
    ?
    <div className="comment-edit" onClick={editComment}>ìˆ˜ì •ì™„ë£Œ</div>
    :
    <div className="comment-edit" onClick={() => { setEditClicked(true); setEditCommentId(a.id); setEdittingComment(a.body) }}>ìˆ˜ì •</div>
}
												
```

stateì— ë”°ë¼ì„œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì…ë ¥ì°½ì´ ë‚˜ì˜¤ê±°ë‚˜, ê·¸ëƒ¥ ëŒ“ê¸€ì„ ë³´ì—¬ì£¼ê±°ë‚˜ í•œë‹¤.   
<center>ğŸ‘‡</center> 

```js
{
    editClicked == true && editCommentId == a.id
    ?
    <div className='comment-content'>
        <textarea style={{ width: '100%', wordBreak: 'break-all' }} value={edittingComment} onChange={(e) => { setEdittingComment(e.target.value) }}></textarea>
    </div>
    :
    <div className='comment-content'>
        <div style={{ fontSize: 'large', width: '100%', wordBreak: 'break-all' }}>{a.body}</div>
    </div>
}
```
> ìˆ˜ì •ë²„íŠ¼ ëˆ„ë¥´ê¸° ì „
![image](https://user-images.githubusercontent.com/80660585/186672479-8f6e785f-ceaa-4df0-b3c4-a452c87e8186.png)

> ìˆ˜ì •ë²„íŠ¼ ëˆ„ë¥¸ í›„
![image](https://user-images.githubusercontent.com/80660585/186672645-a1d808ee-5f15-4733-af54-afd2aac1dec3.png)




















